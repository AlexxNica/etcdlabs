<md-sidenav-layout>
    <md-sidenav #left [opened]="true" mode="side" class="doc-sidenav">
        <md-list>
            <a routerLink="/doc/{{version.etcdVersionURL}}">
                <h3 md-subheader>Getting Started ({{version.etcdVersion}})</h3>
            </a>
            <md-list-item *ngFor="let item of getStartedItems">
                <a routerLink="{{item.url}}" class="{{item.htmlClass}}">{{item.title}}</a>
            </md-list-item>

            <md-divider></md-divider>

            <h3 md-subheader>More</h3>
            <md-list-item *ngFor="let item of moreItems">
                <a routerLink="{{item.url}}" class="{{item.htmlClass}}">{{item.title}}</a>
            </md-list-item>
        </md-list>
    </md-sidenav>

    <div class="doc-group">
        <router-outlet></router-outlet>

        <h4>
            Install and Deploy etcd <span class="versions-link-normal">(latest {{etcdVersionLatestRelease}})</span>
        </h4>

        <br>
        <p>
            This is an example workflow to install and deploy etcd (for/with Kubernetes).
        </p>
        <br>

        <md-card>
            <md-checkbox [(ngModel)]="inputSecure">Secure connection (HTTPS)</md-checkbox>
            <md-checkbox [(ngModel)]="inputEnableProfile">Enable profiler</md-checkbox>
            <md-checkbox [(ngModel)]="inputDebug">Debug mode</md-checkbox>
            <p></p>
            <md-input type="text" [(ngModel)]="inputEtcdVersion" placeholder="etcd version"></md-input>
            <md-input type="text" [(ngModel)]="inputEtcdExecDir" placeholder="exec dir"></md-input>
            <md-input type="number" [(ngModel)]="inputAutoCompact" placeholder="auto compaction (hour)"></md-input>
            <md-input type="number" [(ngModel)]="inputClusterSize" placeholder="Cluster size (up to 7)"></md-input>
            <span *ngIf="inputClusterSize > 7" class="error-message">This tool only supports up to 7 nodes</span>
            <span *ngIf="inputClusterSize < 1" class="error-message">Minimum cluster size is 1</span>
            <span *ngIf="inputClusterSize % 2 == 0" class="error-message">Cluster size should an odd number</span>
            <br>

            <div *ngFor="let flag of flags; let i = index;">
                <div *ngIf="inputClusterSize > i">
                    <br>
                    <md-card-subtitle class="sub-sub-title">Node {{i+1}}</md-card-subtitle>
                    <md-input type="text" [(ngModel)]="flag.name" placeholder="etcd name"></md-input>
                    <md-input type="text" [(ngModel)]="flag.dataDir" placeholder="data directory"></md-input>
                    <md-input type="text" [(ngModel)]="flag.ipAddress" placeholder="IP address"></md-input>
                    <md-input type="number" [(ngModel)]="flag.clientPort" placeholder="client port"></md-input>
                    <md-input type="number" [(ngModel)]="flag.peerPort" placeholder="peer port"></md-input>
                    <br>
                    <md-input type="text" [(ngModel)]="flag.initialClusterToken" placeholder="cluster token"></md-input>
                    <md-input type="text" [(ngModel)]="flag.initialClusterState" placeholder="cluster state"></md-input>
                    <span *ngIf="flag.initialClusterState != 'new' && flag.initialClusterState != 'existing'" class="error-message">Cluster state must be either 'new' or 'existing'</span>
                    <br>
                    <md-input type="text" [(ngModel)]="flag.clientCertFile" placeholder="client cert"></md-input>
                    <md-input type="text" [(ngModel)]="flag.clientKeyFile" placeholder="client key"></md-input>
                    <md-input type="text" [(ngModel)]="flag.clientTrustedCAFile" placeholder="client trusted CA"></md-input>
                    <br>
                    <md-input type="text" [(ngModel)]="flag.peerCertFile" placeholder="peer cert"></md-input>
                    <md-input type="text" [(ngModel)]="flag.peerKeyFile" placeholder="peer key"></md-input>
                    <md-input type="text" [(ngModel)]="flag.peerTrustedCAFile" placeholder="peer trusted CA"></md-input>
                </div>
            </div>

            <br>
            <md-card-actions>
                <a href="{{version.etcdFlagPage}}" target="_blank"><button md-button color="warn">More flags</button></a>
            </md-card-actions>
        </md-card>

        <br><br>

        <md-tab-group>

            <md-tab>
                <template md-tab-label>
					Build from source
				</template>
                <template md-tab-content>
					<br>
					<p>
						etcd is written in Go. To build from source, you need Go 1.7+. This assumes host OS is Linux.
					</p>
					<p>
						<md-input type="text" [(ngModel)]="inputGoVersion" placeholder="Go version"></md-input>
					</p>
					<div class="osx-window">
						<div class="window">
							<div class="titlebar">
								<div class="buttons">
									<div class="closebtn"><span><strong></strong></span></div>
									<div class="minimize"><span><strong></strong></span></div>
									<div class="zoom"><span><strong></strong></span></div>
								</div><span class="title-bar-text">terminal</span></div>
							<div class="content">
								<pre class="osx-terminal-contents">{{getGoCommand()}}</pre>
							</div>
						</div>
					</div>
					<br>
					<p>
						Now let's build etcd from source.
					</p>
					<p>
						<md-input type="text" [(ngModel)]="inputGitUser" placeholder="Git User"></md-input>
						<md-input type="text" [(ngModel)]="inputGitBranch" placeholder="Git Branch"></md-input>
					</p>
					<div class="osx-window">
						<div class="window-narrow">
							<div class="titlebar">
								<div class="buttons">
									<div class="closebtn"><span><strong></strong></span></div>
									<div class="minimize"><span><strong></strong></span></div>
									<div class="zoom"><span><strong></strong></span></div>
								</div><span class="title-bar-text">terminal</span></div>
							<div class="content">
								<pre class="osx-terminal-contents">{{getEtcdCommandBuildFromSource()}}</pre>
							</div>
						</div>
					</div>
					<br>
				</template>
            </md-tab>


            <md-tab>
                <template md-tab-label>
					TLS (cfssl)
				</template>
                <template md-tab-content>
					<br>
					<h5>Why?</h5>
					<p>
						If etcd stores information that should not be public, encryption is highly recommended.
					</p>
					<p>
						etcd supports SSL/TLS and authentication for clients-to-server and peer-to-peer communication.
					</p>
					<p>
						Here's how to generate self-signed TLS certificates with
						<a href="https://github.com/cloudflare/cfssl" target="_blank" class="normal-link">cfssl</a>.
					</p>

					<br>
					<h5>Install cfssl</h5>
					<br>
					<md-input type="text" [(ngModel)]="inputCFSSLVersion" placeholder="cfssl version"></md-input>
					<md-input type="text" [(ngModel)]="inputCFSSLExecDir" placeholder="exec dir"></md-input>
					<br>
					<div class="osx-window">
						<div class="window">
							<div class="titlebar">
								<div class="buttons">
									<div class="closebtn"><span><strong></strong></span></div>
									<div class="minimize"><span><strong></strong></span></div>
									<div class="zoom"><span><strong></strong></span></div>
								</div><span class="title-bar-text">terminal</span></div>
							<div class="content">
								<pre class="osx-terminal-contents">{{getCFSSLCommandInitial()}}</pre>
							</div>
						</div>
					</div>

					<br>
					<md-card-subtitle>Certificate Configuration</md-card-subtitle>
					<md-input type="text" [(ngModel)]="inputCFSSLOrganization" placeholder="Organization"></md-input>
					<md-input type="text" [(ngModel)]="inputCFSSLOrganizationUnit" placeholder="Organization Unit"></md-input>
					<md-input type="text" [(ngModel)]="inputCFSSLLocationCity" placeholder="City"></md-input>
					<md-input type="text" [(ngModel)]="inputCFSSLLocationState" placeholder="State"></md-input>
					<md-input type="text" [(ngModel)]="inputCFSSLLocationCountry" placeholder="Country"></md-input>
					<br>
					<md-input type="text" [(ngModel)]="inputCFSSLKeyAlgorithm" placeholder="Key Algorithm"></md-input>
					<md-input type="number" [(ngModel)]="inputCFSSLKeySize" placeholder="Key Size"></md-input>
					<md-input type="number" [(ngModel)]="inputCFSSLKeyExpirationHour" placeholder="Key Expiration (hour)"></md-input>
					<br>
					<md-input type="text" [(ngModel)]="inputCFSSLCommonName" placeholder="Common Name"></md-input>
					<br>
					<br>

					<h5>Generate self-signed root CA certificate</h5>
					<pre class="code-dark">{{getCFSSLCommandRootCA()}}</pre>
					Results:
					<div class="osx-window">
						<div class="window-narrow">
							<div class="titlebar">
								<div class="buttons">
									<div class="closebtn"><span><strong></strong></span></div>
									<div class="minimize"><span><strong></strong></span></div>
									<div class="zoom"><span><strong></strong></span></div>
								</div><span class="title-bar-text">terminal</span></div>
							<div class="content">
								<pre class="osx-terminal-contents">{{getCFSSLCommandRootCAResult()}}</pre>
							</div>
						</div>
					</div>

					<br>
					<h5>Create a configuration file</h5>
					<pre class="code-dark">{{getCFSSLCommandConfig()}}</pre>

					<br>
					<h5>Generate local-issued certificates with private keys</h5>
					<p *ngIf="flags[0].ipAddress == 'localhost'">
						Seems like cert is configured for localhost. Please make sure to specify remote hosts, if any.
					</p>
					<div *ngFor="let flag of flags; let i = index;">
						<div *ngIf="inputClusterSize > i">
							<pre class="code-dark">{{getCFSSLCommandKeys(flag)}}</pre>
						</div>
					</div>
					<div class="osx-window">
						<div class="window-narrow">
							<div class="titlebar">
								<div class="buttons">
									<div class="closebtn"><span><strong></strong></span></div>
									<div class="minimize"><span><strong></strong></span></div>
									<div class="zoom"><span><strong></strong></span></div>
								</div><span class="title-bar-text">terminal</span></div>
							<div class="content">
								<pre class="osx-terminal-contents">{{ggetCFSSLCommandResults()}}</pre>
							</div>
						</div>
					</div>

					<br>
					<md-input type="text" [(ngModel)]="inputCertsDir" placeholder="certs dir"></md-input>
					<br>
					<div class="osx-window">
						<div class="window-narrow">
							<div class="titlebar">
								<div class="buttons">
									<div class="closebtn"><span><strong></strong></span></div>
									<div class="minimize"><span><strong></strong></span></div>
									<div class="zoom"><span><strong></strong></span></div>
								</div><span class="title-bar-text">terminal</span></div>
							<div class="content">
								<pre class="osx-terminal-contents">{{getCFSSLCommandKeysCopyGCP()}}</pre>
							</div>
						</div>
					</div>
				</template>
            </md-tab>


            <md-tab>
                <template md-tab-label>
					Bare metal, VM
				</template>
                <template md-tab-content>
					<br>
					<h5>Why?</h5>
					<p>
						etcd writes data to disk. Such stateful application is complicated to run in container.
					</p>
					<p>
						Bare metal or virtual machine is the simplest way to run etcd.
					</p>

					<br>
					<h5>Install releases</h5>
					<div class="osx-window">
						<div class="window-narrow">
							<div class="titlebar">
								<div class="buttons">
									<div class="closebtn"><span><strong></strong></span></div>
									<div class="minimize"><span><strong></strong></span></div>
									<div class="zoom"><span><strong></strong></span></div>
								</div><span class="title-bar-text">terminal</span></div>
							<div class="content">
								<pre class="osx-terminal-contents">{{getEtcdCommandVMInitial()}}</pre>
							</div>
						</div>
					</div>

					<br>
					<h5>Install on Linux</h5>
					<pre class="code-dark">{{getEtcdCommandVMInstallLinux()}}</pre>

					<br>
					<h5>Install on Mac OS (Darwin)</h5>
					<pre class="code-dark">{{getEtcdCommandVMInstallOSX()}}</pre>

					<br>
					<h5>Deploy etcd cluster</h5>
					<p *ngIf="flags[0].ipAddress == 'localhost'">
						Seems like etcd is configured to run in localhost. Please make sure ports do not conflict!
					</p>
					<div class="osx-window">
						<div class="window-narrow">
							<div class="titlebar">
								<div class="buttons">
									<div class="closebtn"><span><strong></strong></span></div>
									<div class="minimize"><span><strong></strong></span></div>
									<div class="zoom"><span><strong></strong></span></div>
								</div><span class="title-bar-text">terminal</span></div>
							<div class="content">
								<pre class="osx-terminal-contents">{{getEtcdCommandVMCreateDir()}}</pre>
							</div>
						</div>
					</div>

					<div *ngFor="let flag of flags; let i = index;">
						<div *ngIf="inputClusterSize > i">
							<pre class="code-dark">{{getEtcdCommandVMBash(flag)}}</pre>
						</div>
					</div>

					Check status:
					<div class="osx-window">
						<div class="window-narrow">
							<div class="titlebar">
								<div class="buttons">
									<div class="closebtn"><span><strong></strong></span></div>
									<div class="minimize"><span><strong></strong></span></div>
									<div class="zoom"><span><strong></strong></span></div>
								</div><span class="title-bar-text">terminal</span></div>
							<div class="content">
								<pre class="osx-terminal-contents">{{getEtcdctlCommandVMBash(flags[0])}}</pre>
							</div>
						</div>
					</div>
				</template>
            </md-tab>


            <md-tab>
                <template md-tab-label>
					systemd
				</template>
                <template md-tab-content>
					<br>
					<h5>Why?</h5>
					<p>
						<a href="https://en.wikipedia.org/wiki/Systemd" target="_blank" class="normal-link">systemd</a> can help bootstrap
						etcd cluster.
					</p>

					<br>
					<h5>Set up systemd service</h5>
					<div *ngFor="let flag of flags; let i = index;">
						<div *ngIf="inputClusterSize > i">
							<pre class="code-dark">{{getEtcdCommandVMSystemdServiceFile(flag)}}</pre>
						</div>
					</div>

					Check status:
					<div class="osx-window">
						<div class="window-narrow">
							<div class="titlebar">
								<div class="buttons">
									<div class="closebtn"><span><strong></strong></span></div>
									<div class="minimize"><span><strong></strong></span></div>
									<div class="zoom"><span><strong></strong></span></div>
								</div><span class="title-bar-text">terminal</span></div>
							<div class="content">
								<pre class="osx-terminal-contents">{{getEtcdCommandVMSystemdServiceFileResult()}}</pre>
							</div>
						</div>
					</div>
					<div class="osx-window">
						<div class="window-narrow">
							<div class="titlebar">
								<div class="buttons">
									<div class="closebtn"><span><strong></strong></span></div>
									<div class="minimize"><span><strong></strong></span></div>
									<div class="zoom"><span><strong></strong></span></div>
								</div><span class="title-bar-text">terminal</span></div>
							<div class="content">
								<pre class="osx-terminal-contents">{{getEtcdctlCommandVMBash(flags[0])}}</pre>
							</div>
						</div>
					</div>
				</template>
            </md-tab>

            <md-tab>
                <template md-tab-label>
					Kubernetes
				</template>
                <template md-tab-content>
					<br>
					<h5>Why?</h5>
					<p>
						Application container gives much portability to initial development phase.
					</p>
					<p>
						But operating and scaling container requires much more work.
					</p>
					<p>
						<a href="http://kubernetes.io/" target="_blank" class="normal-link">Kubernetes</a> manages such complex container environments.
					</p>
					<p>
						And here's how to run etcd with Kubernetes.
					</p>
					<p>
						Kubernetes stores all states in etcd, which is recommended to run independently.
					</p>
					<p>
						This assumes that etcd cluster for Kubernetes is already running.
					</p>

					<br>
					<h5>Install Kubernetes</h5>
					<br>
					<md-input type="text" [(ngModel)]="inputKubernetesVersion" placeholder="version"></md-input>
					<md-input type="text" [(ngModel)]="inputKubernetesGOOS" placeholder="GOOS"></md-input>
					<md-input type="text" [(ngModel)]="inputKubernetesGOARCH" placeholder="GOARCH"></md-input>
					<md-input type="text" [(ngModel)]="inputKubernetesExecDir" placeholder="exec dir"></md-input>
					<br>

					<div class="osx-window">
						<div class="window">
							<div class="titlebar">
								<div class="buttons">
									<div class="closebtn"><span><strong></strong></span></div>
									<div class="minimize"><span><strong></strong></span></div>
									<div class="zoom"><span><strong></strong></span></div>
								</div><span class="title-bar-text">terminal</span></div>
							<div class="content">
								<pre class="osx-terminal-contents">{{getKubernetesCommandInstall()}}</pre>
							</div>
						</div>
					</div>
					<p>
						<span class="code-light-snippet">kube-apiserver</span>, <span class="code-light-snippet">kube-controller-manager</span>,
						<span class="code-light-snippet">kube-scheduler</span> are to be run on the same machines.
					</p>
					<p>
						And running multiple copies is recommended for higher availability.
					</p>
					<p>
						When multiple copies are run, each component will elect a leader via <span class="code-light-snippet">kube-apiserver</span>						that talks to etcd cluster.
					</p>
					<p>
						<span class="code-light-snippet">kubectl</span> is the client that talks to <span class="code-light-snippet">kube-apiserver</span>						server.
					</p>

					<br>
					<h5>kube-apiserver</h5>


					<br>
					<h5>kube-controller-manager</h5>


					<br>
					<h5>kube-scheduler</h5>


					<br>
					<h5>kube-proxy</h5>


					<br>
					<h5>kubelet</h5>


					<br>
					<h5>kubectl</h5>


					<br>
					<h5>Easier way?</h5>
					<p>
						Any easier way to run Kubernetes? Please visit <a href="http://kubernetes.io/docs" target="_blank" class="normal-link">Kubernetes Guides</a>.
					</p>
					<p>
						Any easier way to run etcd? Please visit <a href="https://github.com/coreos/kube-etcd-controller" target="_blank" class="normal-link">kube-etcd-controller</a>.
					</p>
				</template>
            </md-tab>

        </md-tab-group>
    </div>
</md-sidenav-layout>